<!DOCTYPE index.html>
<html lang="vietnamBounds">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FloodSim </title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Map container */
        #map {
            flex: 1;
            height: 100vh;
        }
        
        /* Legend panel on the right */
        .legend-panel {
            width: 350px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border-left: 3px solid #0044ff;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }
        
        .panel-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0044ff;
        }
        
        .panel-title {
            color: #0044ff;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .panel-subtitle {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Search box */
        .search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            max-width: 90%;
            z-index: 1000;
        }
        
        .search-box {
            display: flex;
            background: white;
            border-radius: 50px;
            box-shadow: 0 8px 30px rgba(0, 68, 255, 0.2);
            overflow: hidden;
            border: 2px solid #0044ff;
            transition: all 0.3s ease;
        }
        
        .search-box:focus-within {
            box-shadow: 0 12px 40px rgba(0, 68, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .search-icon {
            padding: 0 20px;
            background: linear-gradient(135deg, #0044ff 0%, #0066ff 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .search-input {
            flex: 1;
            padding: 18px 20px;
            border: none;
            outline: none;
            font-size: 16px;
            color: #333;
            background: transparent;
        }
        
        .search-input::placeholder {
            color: #999;
            font-weight: 500;
        }
        
        .search-button {
            background: linear-gradient(135deg, #0044ff 0%, #0066ff 100%);
            color: white;
            border: none;
            padding: 0 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-button:hover {
            background: linear-gradient(135deg, #0033cc 0%, #0055cc 100%);
            padding: 0 35px;
        }
        
        .search-results {
            background: white;
            border-radius: 15px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 10px 35px rgba(0, 68, 255, 0.15);
            display: none;
            border: 2px solid #0044ff;
            border-top: none;
        }
        
        .search-result-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .search-result-item:hover {
            background: linear-gradient(90deg, #f0f7ff 0%, #e6f0ff 100%);
            transform: translateX(5px);
        }
        
        .search-result-item i {
            color: #0044ff;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .result-title {
            font-weight: 600;
            color: #0044ff;
            margin-bottom: 5px;
            font-size: 15px;
        }
        
        .result-subtitle {
            font-size: 13px;
            color: #666;
        }
        
        .no-results {
            padding: 30px;
            text-align: center;
            color: #888;
            font-style: italic;
            font-size: 15px;
        }
        
        /* Legend sections */
        .legend-section {
            margin-bottom: 25px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e6ff;
        }
        
        .section-title {
            color: #0044ff;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e6ff;
        }
        
        .section-title i {
            font-size: 18px;
        }
        
        /* Legend items */
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8faff;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.2s;
        }
        
        .legend-item:hover {
            transform: translateX(5px);
            background: #f0f7ff;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        .legend-text {
            font-size: 14px;
            color: #333;
            flex: 1;
            font-weight: 500;
        }
        
        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #f8faff 0%, #f0f7ff 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e0e6ff;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #0044ff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        /* Info panel styling */
        .info-panel {
            min-width: 350px;
            padding: 15px;
        }
        
        .sim-btn {
            background: linear-gradient(135deg, #d9534f 0%, #c9302c 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            width: 100%;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(217, 83, 79, 0.3);
        }
        
        .sim-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 83, 79, 0.4);
            background: linear-gradient(135deg, #c9302c 0%, #b92b28 100%);
        }
        
        .history-alert {
            margin-top: 15px;
            padding: 15px;
            border-left: 5px solid;
            font-size: 14px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #fff2f0 0%, #ffe6e3 100%);
            border-color: #d9534f;
        }
        
        .alert-safe {
            background: linear-gradient(135deg, #f6ffed 0%, #e8f5df 100%);
            border-color: #52c41a;
        }
        
        select {
            width: 100%;
            padding: 12px 15px;
            margin-top: 10px;
            border: 2px solid #0044ff;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            background: #f8faff;
            color: #333;
            cursor: pointer;
        }
        
        /* Toggle button */
        .legend-toggle {
            position: absolute;
            top: 20px;
            right: 370px;
            background: linear-gradient(135deg, #0044ff 0%, #0066ff 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 18px;
            cursor: pointer;
            z-index: 1000;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 68, 255, 0.3);
            transition: all 0.3s;
        }
        
        .legend-toggle:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(0, 68, 255, 0.4);
            background: linear-gradient(135deg, #0033cc 0%, #0055cc 100%);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .legend-panel {
                width: 300px;
            }
            
            .legend-toggle {
                right: 320px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .legend-panel {
                width: 100%;
                height: 400px;
                border-left: none;
                border-top: 3px solid #0044ff;
                order: 2;
            }
            
            #map {
                order: 1;
                height: calc(100vh - 400px);
            }
            
            .search-container {
                width: 95%;
                top: 10px;
            }
            
            .search-box {
                border-radius: 15px;
            }
            
            .search-input {
                padding: 15px;
                font-size: 14px;
            }
            
            .legend-toggle {
                display: none;
            }
        }
        
        /* Scrollbar styling */
        .legend-panel::-webkit-scrollbar {
            width: 6px;
        }
        
        .legend-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .legend-panel::-webkit-scrollbar-thumb {
            background: #0044ff;
            border-radius: 3px;
        }
        
        /* Loading animation */
        .loading-text {
            color: #666;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px;
            font-size: 15px;
        }
        
        .loading-text::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0044ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Custom search container -->
    <div class="search-container">
        <div class="search-box">
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
            <input type="text" class="search-input" id="searchInput" 
                   placeholder="Nhập tỉnh thành, thành phố hoặc địa điểm tại Việt Nam..." 
                   autocomplete="off">
            <button class="search-button" onclick="performSearch()">
                <i class="fas fa-search"></i>
                Tìm
            </button>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>
    
    <!-- Toggle button for legend -->
    <button class="legend-toggle" id="legendToggle">
        <i class="fas fa-layer-group"></i>
        Chú thích
    </button>
    
    <!-- Map -->
    <div id="map"></div>
    
    <!-- Legend panel on the right -->
    <div class="legend-panel" id="legendPanel">
        <div class="panel-header">
            <div class="panel-title">
                <i class="fas fa-water"></i>
                FLOODSIM
            </div>
            <div class="panel-subtitle">Hệ thống cảnh báo ngập lụt thông minh</div>
        </div>
        
        <!-- Legend section -->
        <div class="legend-section">
            <div class="section-title">
                <i class="fas fa-map-marker-alt"></i>
                CHÚ THÍCH BẢN ĐỒ
            </div>
            
            <div class="legend-item" style="border-left-color: #ff0000;">
                <div class="legend-color" style="background: #ff0000;"></div>
                <div class="legend-text">Thủy điện lớn (>100MW)</div>
            </div>
            
            <div class="legend-item" style="border-left-color: #ff9900;">
                <div class="legend-color" style="background: #ff9900;"></div>
                <div class="legend-text">Thủy điện vừa (30-100MW)</div>
            </div>
            
            <div class="legend-item" style="border-left-color: #0066ff;">
                <div class="legend-color" style="background: #0066ff;"></div>
                <div class="legend-text">Hồ chứa nước & đập</div>
            </div>
            
            <div class="legend-item" style="border-left-color: #33cc33;">
                <div class="legend-color" style="background: #33cc33;"></div>
                <div class="legend-text">Vùng an toàn (ít ngập)</div>
            </div>
            
            <div class="legend-item" style="border-left-color: #ff3333;">
                <div class="legend-color" style="background: #ff3333;"></div>
                <div class="legend-text">Vùng nguy hiểm (thường xuyên ngập)</div>
            </div>
            
            <div class="legend-item" style="border-left-color: #800080;">
                <div class="legend-color" style="background: rgba(128, 0, 128, 0.3); border: 2px solid #800080;"></div>
                <div class="legend-text">Khu vực ảnh hưởng xả lũ</div>
            </div>
        </div>
        
        <!-- Statistics section -->
        <div class="legend-section">
            <div class="section-title">
                <i class="fas fa-chart-bar"></i>
                THỐNG KÊ HỆ THỐNG
            </div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalDams">40</div>
                    <div class="stat-label">Công trình thủy điện</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="dangerAreas">9</div>
                    <div class="stat-label">Tỉnh nguy hiểm</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="largeDams">12</div>
                    <div class="stat-label">Thủy điện lớn</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="mediumDams">25</div>
                    <div class="stat-label">Thủy điện vừa</div>
                </div>
            </div>
        </div>
        
        <!-- Calculation info -->
        <div class="legend-section">
            <div class="section-title">
                <i class="fas fa-calculator"></i>
                
        
        <!-- Instructions -->
        <div class="legend-section">
            <div class="section-title">
                <i class="fas fa-info-circle"></i>
                HƯỚNG DẪN SỬ DỤNG
            </div>
            
            <div style="font-size: 13px; color: #555; line-height: 1.5;">
                <p><strong>1.</strong> Nhấn vào bản đồ để chọn vị trí phân tích</p>
                <p><strong>2.</strong> Hệ thống tự động tìm 3 đập gần nhất</p>
                <p><strong>3.</strong> Chọn đập để mô phỏng xả lũ</p>
                <p><strong>4.</strong> Nhập lưu lượng xả và chạy mô phỏng</p>
                <p><strong>5.</strong> Xem kết quả cảnh báo trên bản đồ</p>
            </div>
        </div>
        
        <!-- Footer -->
        <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e6ff;">
            <div style="font-size: 12px; color: #888; margin-bottom: 5px;">
                Dữ liệu cập nhật đến tháng 12/2025
            </div>
            <div style="font-size: 11px; color: #aaa;">
                © 2025 FloodSim 
        </div>
    </div>

    <script>
        // Variables
        let legendVisible = true;
        
        // Toggle legend panel
        document.getElementById('legendToggle').addEventListener('click', function() {
            const legendPanel = document.getElementById('legendPanel');
            const toggleBtn = document.getElementById('legendToggle');
            
            if (legendVisible) {
                legendPanel.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-layer-group"></i> Hiện chú thích';
                toggleBtn.style.right = '20px';
            } else {
                legendPanel.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-layer-group"></i> Chú thích';
                toggleBtn.style.right = '370px';
                if (window.innerWidth <= 1200) {
                    toggleBtn.style.right = '320px';
                }
            }
            legendVisible = !legendVisible;
        });
        
        // Initialize map
        var vietnamBounds = L.latLngBounds(
            [8.0, 102.0],  // Tây Nam
            [23.5, 110.0]   // Đông Bắc
        );

        var map = L.map('map', {
            center: [16.0, 106.0],
            zoom: 6,
            maxBounds: vietnamBounds,
            maxZoom: 18,
            minZoom: 6
        });

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | FloodSim',
            maxZoom: 18,
            noWrap: true,
            bounds: vietnamBounds
        }).addTo(map);

      
        

      // Thêm layer tên địa phương
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "",
        maxZoom: 18,
        noWrap: true,
        bounds: vietnamBounds,
      }).addTo(map);

      // 1. DATA: DANH SÁCH 40 ĐẬP (Rút gọn demo vài cái chính)
      var danhSachDap = [
        {
          id: 1,
          ten: "Thủy điện Lai Châu",
          vido: 22.385,
          kinhdo: 102.793,
          loai: "Lớn",
          thuongNguon: "Biên giới TQ",
        },
        {
          id: 2,
          ten: "Thủy điện Sơn La",
          vido: 21.4939,
          kinhdo: 103.9822,
          loai: "Lớn",
          thuongNguon: "TĐ Lai Châu",
        },
        {
          id: 3,
          ten: "Thủy điện Hòa Bình",
          vido: 20.8146,
          kinhdo: 105.3373,
          loai: "Lớn",
          thuongNguon: "TĐ Sơn La",
        },
        {
          id: 4,
          ten: "Thủy điện Thác Bà",
          vido: 21.7569,
          kinhdo: 105.0569,
          loai: "Lớn",
          thuongNguon: "Sông Chảy",
        },
        {
          id: 5,
          ten: "Thủy điện Tuyên Quang",
          vido: 22.1833,
          kinhdo: 105.25,
          loai: "Lớn",
          thuongNguon: "Sông Gâm",
        },
        {
          id: 6,
          ten: "Thủy điện Bản Vẽ",
          vido: 19.05,
          kinhdo: 104.65,
          loai: "Lớn",
          thuongNguon: "Sông Cả",
        },
        {
          id: 7,
          ten: "Thủy điện Sông Tranh 2",
          vido: 15.3833,
          kinhdo: 108.1833,
          loai: "Vừa",
          thuongNguon: "Sông Tranh",
        },
        {
          id: 8,
          ten: "Thủy điện A Vương",
          vido: 15.7667,
          kinhdo: 107.8,
          loai: "Vừa",
          thuongNguon: "Sông A Vương",
        },
        {
          id: 9,
          ten: "Thủy điện Đồng Nai 3",
          vido: 11.9667,
          kinhdo: 108.2833,
          loai: "Vừa",
          thuongNguon: "Sông Đồng Nai",
        },
        {
          id: 10,
          ten: "Thủy điện Đồng Nai 4",
          vido: 11.8167,
          kinhdo: 108.1667,
          loai: "Vừa",
          thuongNguon: "Sông Đồng Nai",
        },
        {
          id: 11,
          ten: "Hồ Thác Bà",
          vido: 21.7569,
          kinhdo: 105.0569,
          loai: "Hồ",
          thuongNguon: "Sông Chảy",
        },
        {
          id: 12,
          ten: "Hồ Sông Cầu",
          vido: 21.2833,
          kinhdo: 105.85,
          loai: "Hồ",
          thuongNguon: "Sông Cầu",
        },
        {
          id: 13,
          ten: "Hồ Kẻ Gỗ (Hà Tĩnh)",
          vido: 18.2333,
          kinhdo: 105.95,
          loai: "Hồ",
          thuongNguon: "Sông Rào Cái",
        },
        {
          id: 14,
          ten: "Thủy điện Bình Điền",
          vido: 16.3667,
          kinhdo: 107.7333,
          loai: "Vừa",
          thuongNguon: "Sông Bồ",
        },
        {
          id: 15,
          ten: "Thủy điện Hương Điền",
          vido: 16.483,
          kinhdo: 107.452,
          loai: "Vừa",
          thuongNguon: "Sông Bồ",
        },
        {
          id: 16,
          ten: "Thủy điện Rào Quán",
          vido: 16.8167,
          kinhdo: 106.9667,
          loai: "Vừa",
          thuongNguon: "Sông Rào Quán",
        },
        {
          id: 17,
          ten: "Thủy điện Sêrêpốk 3",
          vido: 12.6667,
          kinhdo: 107.8333,
          loai: "Vừa",
          thuongNguon: "Sông Sêrêpốk",
        },
        {
          id: 18,
          ten: "Thủy điện Sêrêpốk 4",
          vido: 12.5667,
          kinhdo: 107.7667,
          loai: "Vừa",
          thuongNguon: "Sông Sêrêpốk",
        },
        {
          id: 19,
          ten: "Thủy điện Đắk Mi 4",
          vido: 15.4667,
          kinhdo: 107.8333,
          loai: "Vừa",
          thuongNguon: "Sông Đắk Mi",
        },
        {
          id: 20,
          ten: "Thủy điện Đắk Mi 3",
          vido: 15.5167,
          kinhdo: 107.9,
          loai: "Vừa",
          thuongNguon: "Sông Đắk Mi",
        },
        {
          id: 21,
          ten: "Thủy điện Krông H'Năng",
          vido: 12.5,
          kinhdo: 108.3333,
          loai: "Vừa",
          thuongNguon: "Sông Krông H'Năng",
        },
        {
          id: 22,
          ten: "Thủy điện Đắk Kar",
          vido: 12.1667,
          kinhdo: 108.5,
          loai: "Vừa",
          thuongNguon: "Sông Đắk Kar",
        },
        {
          id: 23,
          ten: "Thủy điện Đại Ninh",
          vido: 11.5833,
          kinhdo: 108.3333,
          loai: "Vừa",
          thuongNguon: "Sông Đa Nhim",
        },
        {
          id: 24,
          ten: "Thủy điện Hàm Thuận - Đa Mi",
          vido: 11.25,
          kinhdo: 108.0833,
          loai: "Lớn",
          thuongNguon: "Sông La Ngà",
        },
        {
          id: 25,
          ten: "Thủy điện Cần Đơn",
          vido: 11.8333,
          kinhdo: 106.8333,
          loai: "Vừa",
          thuongNguon: "Sông Bé",
        },
        {
          id: 26,
          ten: "Thủy điện Thác Mơ",
          vido: 11.8333,
          kinhdo: 107.0,
          loai: "Vừa",
          thuongNguon: "Sông Bé",
        },
        {
          id: 27,
          ten: "Thủy điện Srok Phu Miêng",
          vido: 12.3333,
          kinhdo: 107.1667,
          loai: "Vừa",
          thuongNguon: "Sông Srok Phu Miêng",
        },
        {
          id: 28,
          ten: "Thủy điện Đức Xuyên",
          vido: 11.9167,
          kinhdo: 107.5,
          loai: "Vừa",
          thuongNguon: "Sông Đồng Nai",
        },
        {
          id: 29,
          ten: "Thủy điện Đồng Nai 2",
          vido: 11.75,
          kinhdo: 108.0833,
          loai: "Vừa",
          thuongNguon: "Sông Đồng Nai",
        },
        {
          id: 30,
          ten: "Thủy điện Đắk R'Tíh",
          vido: 12.0833,
          kinhdo: 108.1667,
          loai: "Vừa",
          thuongNguon: "Sông Đắk R'Tíh",
        },
        {
          id: 31,
          ten: "Thủy điện Trị An",
          vido: 11.127,
          kinhdo: 107.085,
          loai: "Lớn",
          thuongNguon: "Sông Đồng Nai",
        },
        {
          id: 32,
          ten: "Thủy điện Vĩnh Sơn",
          vido: 14.0833,
          kinhdo: 108.75,
          loai: "Vừa",
          thuongNguon: "Sông Ba",
        },
        {
          id: 33,
          ten: "Thủy điện Sông Ba Hạ",
          vido: 13.4167,
          kinhdo: 108.8333,
          loai: "Vừa",
          thuongNguon: "Sông Ba",
        },
        {
          id: 34,
          ten: "Thủy điện Ayun Hạ",
          vido: 13.5833,
          kinhdo: 108.5,
          loai: "Vừa",
          thuongNguon: "Sông Ayun",
        },
        {
          id: 35,
          ten: "Thủy điện Ialy",
          vido: 14.1667,
          kinhdo: 107.8333,
          loai: "Lớn",
          thuongNguon: "Sông Sê San",
        },
        {
          id: 36,
          ten: "Thủy điện Sê San 3",
          vido: 14.3333,
          kinhdo: 107.8333,
          loai: "Vừa",
          thuongNguon: "Sông Sê San",
        },
        {
          id: 37,
          ten: "Thủy điện Sê San 3A",
          vido: 14.25,
          kinhdo: 107.75,
          loai: "Vừa",
          thuongNguon: "Sông Sê San",
        },
        {
          id: 38,
          ten: "Thủy điện Plei Krông",
          vido: 14.5833,
          kinhdo: 107.9167,
          loai: "Vừa",
          thuongNguon: "Sông Sê San",
        },
        {
          id: 39,
          ten: "Thủy điện Sông Hinh",
          vido: 12.8333,
          kinhdo: 108.9167,
          loai: "Vừa",
          thuongNguon: "Sông Ba",
        },
        {
          id: 40,
          ten: "Hồ Dầu Tiếng",
          vido: 11.3619,
          kinhdo: 106.3458,
          loai: "Hồ",
          thuongNguon: "Sông Sài Gòn",
        },
      ];

        // Dangerous areas
        var vungNguyHiem = ["Thừa Thiên Huế", "Quảng Trị", "Quảng Bình", "Hà Tĩnh", "Nghệ An", "Quảng Nam", "Phú Yên", "Khánh Hoà", "Bình Định"];

        // Function to perform search
        function timKiem() {
            var keyword = document.getElementById("searchInput").value.toLowerCase();
            var results = danhSachThuyDien.filter(function(item) {
                return item.ten.toLowerCase().includes(keyword);
            });
            hienThiKetQua(results);
        }

// Hoàn chỉnh: hàm tìm kiếm (gọi bởi nút Tìm)
function performSearch() {
  const q = (document.getElementById('searchInput').value || '').trim().toLowerCase();
  const resultsContainer = document.getElementById('searchResults');

  if (!q) {
    resultsContainer.innerHTML = '<div class="no-results">Vui lòng nhập từ khóa tìm kiếm</div>';
    resultsContainer.style.display = 'block';
    return;
  }

  const prov = (typeof vietnamProvinces !== 'undefined' ? vietnamProvinces : []).filter(p => p.name.toLowerCase().includes(q));
  const dams = (typeof danhSachDap !== 'undefined' ? danhSachDap : []).filter(d => (d.ten && d.ten.toLowerCase().includes(q)) || (d.thuongNguon && d.thuongNguon.toLowerCase().includes(q)));

  let html = '';
  if (prov.length) {
    html += '<div style="padding:8px 12px;"><strong>Kết quả tỉnh/thành phố:</strong></div>';
    prov.forEach(p => {
      html += `<div class="search-result-item" data-lat="${p.lat}" data-lng="${p.lng}">
                 <i class="fas fa-map-marker-alt"></i>
                 <div><div class="result-title">${p.name}</div><div class="result-subtitle">Loại: ${p.type}</div></div>
               </div>`;
    });
  }
  if (dams.length) {
    html += '<div style="padding:8px 12px;"><strong>Kết quả thủy điện:</strong></div>';
    dams.forEach(d => {
      html += `<div class="search-result-item" data-lat="${d.vido}" data-lng="${d.kinhdo}">
                 <i class="fas fa-water"></i>
                 <div><div class="result-title">${d.ten}</div><div class="result-subtitle">${d.thuongNguon || ''} • ${d.congSuat || 'N/A'}</div></div>
               </div>`;
    });
  }
  if (!html) html = '<div class="no-results">Không tìm thấy kết quả phù hợp</div>';

  resultsContainer.innerHTML = html;
  resultsContainer.style.display = 'block';

  // gắn event click
  Array.from(resultsContainer.querySelectorAll('.search-result-item')).forEach(item => {
    item.addEventListener('click', function() {
      const lat = parseFloat(this.dataset.lat), lng = parseFloat(this.dataset.lng);
      if (!isNaN(lat) && !isNaN(lng)) {
        map.setView([lat, lng], 10);
        resultsContainer.style.display = 'none';
      }
    });
  });
}
    </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>