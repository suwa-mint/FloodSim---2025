<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FloodSim </title>

  <!-- Thư viện bên ngoài -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- File CSS  -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>
  <!-- ========== PHẦN TÌM KIẾM ========== -->
  <div class="search-container">
    <div class="search-box">
      <input type="text" class="search-input" id="searchInput"
        placeholder="Nhập tỉnh thành, thành phố hoặc địa điểm tại Việt Nam..." autocomplete="off">
      <button class="search-button" onclick="performSearch()">
        <i class="fas fa-search"></i>Tìm kiếm
      </button>
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <!-- ========== NÚT MỞ BẢNG CHÚ THÍCH ========== -->
  <button class="legend-toggle" id="legendToggle">
    <i class="fas fa-layer-group"></i>Hiện chú thích
  </button>

  <!-- ========== BẢN ĐỒ CHÍNH ========== -->
  <div id="map"></div>

  <!-- ========== BẢNG CHÚ THÍCH (BÊN PHẢI) ========== -->
  <div class="legend-panel" id="legendPanel">
    <div class="panel-header">
      <div class="panel-title"><i class="fas fa-water"></i>FLOODSIM</div>
      <div class="panel-subtitle">Hệ thống cảnh báo ngập lụt thông minh</div>
    </div>

    <!-- Phần chú thích bản đồ -->
    <div class="legend-section">
      <div class="section-title"><i class="fas fa-map-marker-alt"></i>CHÚ THÍCH BẢN ĐỒ</div>
      <div class="legend-item l-large" onclick="toggleDamLayer('large', this)">
        <div class="legend-color"></div>
        <div class="legend-text">Thủy điện lớn (>100MW)</div>
      </div>
      <div class="legend-item l-medium" onclick="toggleDamLayer('medium', this)">
        <div class="legend-color"></div>
        <div class="legend-text">Thủy điện vừa (30-100MW)</div>
      </div>
      <div class="legend-item l-reservoir" onclick="toggleDamLayer('reservoir', this)">
        <div class="legend-color"></div>
        <div class="legend-text">Hồ chứa nước</div>
      </div>
      <div class="legend-item l-danger" onclick="toggleDangerLayer(this)">
        <div class="legend-color"></div>
        <div class="legend-text">Vùng nguy hiểm (thường xuyên ngập)</div>
      </div>
      <div class="legend-item l-flood">
        <div class="legend-color"></div>
        <div class="legend-text">Khu vực ảnh hưởng xả lũ</div>
      </div>
    </div>

    <!-- Phần thống kê -->
    <div class="legend-section">
      <div class="section-title"><i class="fas fa-chart-bar"></i>THỐNG KÊ HỆ THỐNG</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalDams">40</div>
          <div class="stat-label">Công trình thủy điện</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="dangerAreas">9</div>
          <div class="stat-label">Tỉnh nguy hiểm</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="largeDams">12</div>
          <div class="stat-label">Thủy điện lớn</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="mediumDams">25</div>
          <div class="stat-label">Thủy điện vừa</div>
        </div>
      </div>
    </div>

    <!-- Phần hướng dẫn sử dụng -->
    <div class="legend-section">
      <div class="section-title"><i class="fas fa-info-circle"></i>HƯỚNG DẪN SỬ DỤNG</div>
      <div class="instruction-content">
        <p><strong>1.</strong> Nhấn vào chú thích bản đồ để xem vị trí</p>
        <p><strong>2.</strong> Nhấn vào bản đồ để chọn vị trí phân tích</p>
        <p><strong>3.</strong> Hệ thống tự động tìm 3 đập gần nhất</p>
        <p><strong>4.</strong> Chọn đập để mô phỏng xả lũ</p>
        <p><strong>5.</strong> Nhập lưu lượng xả và chạy mô phỏng</p>
        <p><strong>6.</strong> Xem kết quả cảnh báo trên bản đồ</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="panel-footer">
      <div class="footer-note">Dữ liệu cập nhật đến tháng 12/2025</div>
      <div class="footer-copy"> 2025 FloodSim</div>
    </div>
  </div>

  <!-- ========== PANEL XEM ẢNH CHI TIẾT ========== -->
  <div class="dam-detail-panel" id="damDetailPanel">
    <button class="close-detail" onclick="closeDamDetail()">&times;</button>
    <img src="" alt="" class="dam-detail-image" id="damDetailImage" onclick="openImageModal(this.src)"
      title="Nhấn để phóng to">
    <div class="dam-detail-title" id="damDetailTitle"></div>
    <div class="dam-detail-info" id="damDetailInfo"></div>
  </div>

  <!-- ========== MODAL PHÓNG TO ẢNH ========== -->
  <div id="imageModal" class="image-modal" onclick="this.style.display='none'">
    <span class="close-modal">&times;</span>
    <img class="modal-content" id="modalImg">
  </div>

  <!-- ========== TẢI FILE DỮ LIỆU ========== -->
  <script src="js/data.js"></script>
  <script src="js/main.js"></script>

  <!-- Code injected by live-server -->
  <script>
    // <![CDATA[  <-- For SVG support
    if ('WebSocket' in window) {
      (function () {
        function refreshCSS() {
          var sheets = [].slice.call(document.getElementsByTagName("link"));
          var head = document.getElementsByTagName("head")[0];
          for (var i = 0; i < sheets.length; ++i) {
            var elem = sheets[i];
            var parent = elem.parentElement || head;
            parent.removeChild(elem);
            var rel = elem.rel;
            if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
              var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
              elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
            }
            parent.appendChild(elem);
          }
        }
        var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
        var address = protocol + window.location.host + window.location.pathname + '/ws';
        var socket = new WebSocket(address);
        socket.onmessage = function (msg) {
          if (msg.data == 'reload') window.location.reload();
          else if (msg.data == 'refreshcss') refreshCSS();
        };
        if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
          console.log('Live reload enabled.');
          sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
        }
      })();
    }
    else {
      console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
    }
    // ]]>
  </script>
</body>

</html>